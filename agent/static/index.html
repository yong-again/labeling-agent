<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINO-SAM Labeling Agent</title>
    <meta name="description" content="Auto-labeling with Grounding DINO + SAM">
    <link rel="stylesheet" href="/static/style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üéØ</span>
                <h1>DINO-SAM Labeling Agent</h1>
            </div>
            <div class="stats-bar" id="statsBar">
                <div class="stat-item">
                    <span class="stat-value" id="statTotal">0</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="stat-item pending">
                    <span class="stat-value" id="statPending">0</span>
                    <span class="stat-label">Pending</span>
                </div>
                <div class="stat-item approved">
                    <span class="stat-value" id="statApproved">0</span>
                    <span class="stat-label">Approved</span>
                </div>
                <div class="stat-item rejected">
                    <span class="stat-value" id="statRejected">0</span>
                    <span class="stat-label">Rejected</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="tab-upload">1. Upload & Labeling</button>
            <button class="tab-btn" data-tab="tab-result" disabled id="btnTabResult">2. Result Verification</button>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- TAB 1: Upload & Labeling -->
            <div id="tab-upload" class="tab-pane active">
                <div class="upload-container">
                    <div class="panel-section">
                        <h2>üì§ Image Upload</h2>
                        <div class="upload-mode-toggle">
                            <label><input type="radio" name="uploadMode" value="single" checked> Îã®Ïùº</label>
                            <label><input type="radio" name="uploadMode" value="batch"> Î∞∞Ïπò (zip / 2Ïû•+)</label>
                        </div>
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">üìÅ</div>
                            <p id="uploadZoneText">Drag & drop images here</p>
                            <p class="upload-hint">or click to browse</p>
                            <input type="file" id="fileInput" accept="image/*" multiple hidden>
                        </div>
                        <div class="batch-progress" id="batchProgress" hidden>
                            <div class="batch-stage" id="batchStage">ÎåÄÍ∏∞ Ï§ë</div>
                            <div class="batch-progress-bar"><div class="batch-progress-fill" id="batchProgressFill"></div></div>
                            <div class="batch-progress-text" id="batchProgressText">0 / 0</div>
                        </div>
                    </div>

                    <div class="settings-grid">
                        <div class="panel-section">
                            <h2>‚úèÔ∏è Prompt</h2>
                            <div class="prompt-input-wrap">
                                <textarea id="promptInput" placeholder="Enter detection prompt (e.g., 'person. car. dog')"></textarea>
                                <div class="prompt-hint">Separate classes with periods (.)</div>
                            </div>
                        </div>

                        <div class="panel-section">
                            <h2>‚öôÔ∏è Settings</h2>
                            <div class="setting-item">
                                <label for="confidenceSlider">Confidence: <span id="confidenceValue">0.35</span></label>
                                <input type="range" id="confidenceSlider" min="0.1" max="0.9" step="0.05" value="0.35">
                            </div>
                            <div class="setting-item">
                                <label for="formatSelect">Export Format</label>
                                <select id="formatSelect">
                                    <option value="coco">COCO Format</option>
                                    <option value="yolo">YOLO Format</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="clientRenderCheckbox">Client Render (test)</label>
                                <input type="checkbox" id="clientRenderCheckbox" title="Î™®Îç∏ outputÏùÑ ÏõπÏóêÏÑú ÏßÅÏ†ë Î†åÎçîÎßÅ (Ïò§Î≤ÑÎ†àÏù¥ Ïù¥ÎØ∏ÏßÄ ÎåÄÏã†)">
                            </div>
                        </div>
                    </div>

                    <div class="panel-section label-actions" id="labelActions">
                        <button class="btn btn-primary btn-full label-btn-large" id="labelBtn" disabled>
                            üöÄ Run Labeling
                        </button>
                        <button class="btn btn-primary btn-full label-btn-large" id="batchLabelBtn" disabled style="display: none;">
                            üöÄ Batch Labeling
                        </button>
                    </div>
                </div>
            </div>

            <!-- TAB 2: Result Verification -->
            <div id="tab-result" class="tab-pane">
                <div class="result-layout">
                    
                    <!-- Center: Image Canvas -->
                    <section class="canvas-section">
                        <div class="batch-nav" id="batchNav" hidden>
                            <button type="button" class="btn btn-secondary" id="batchPrevBtn" title="Ïù¥Ï†Ñ">‚óÄ Ïù¥Ï†Ñ</button>
                            <span class="batch-nav-text" id="batchNavText">1 / 1</span>
                            <button type="button" class="btn btn-secondary" id="batchNextBtn" title="Îã§Ïùå">Îã§Ïùå ‚ñ∂</button>
                        </div>
                        <div class="canvas-container" id="canvasContainer">
                            <div class="canvas-placeholder" id="canvasPlaceholder">
                                <div class="placeholder-icon">üñºÔ∏è</div>
                                <p>Upload an image to start</p>
                            </div>
                            <canvas id="imageCanvas"></canvas>
                            <div class="loading-overlay" id="loadingOverlay" hidden>
                                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                        </div>
                        
                        <!-- HITL Controls -->
                        <div class="hitl-controls" id="hitlControls" hidden>
                            <div class="hitl-info">
                                <span class="hitl-label">Review:</span>
                                <span class="hitl-count" id="hitlCount">0 objects detected</span>
                            </div>
                            <div class="hitl-buttons">
                                <button class="btn btn-reject" id="rejectBtn" title="Reject (Bad Quality)">
                                    ‚ùå Reject
                                </button>
                                <button class="btn btn-approve" id="approveBtn" title="Approve (Good Quality)">
                                    ‚úÖ Approve
                                </button>
                            </div>
                        </div>
                    </section>

                    <!-- Right Panel: Results & Export -->
                    <aside class="panel right-panel">
                        <div class="panel-section batch-results-header" id="batchResultsHeader" hidden>
                            <h2>üìã Batch Results</h2>
                            <p class="batch-results-summary" id="batchResultsSummary">0 images labeled</p>
                        </div>
                        <div class="panel-section">
                            <h2>üìä Detection Results</h2>
                            <div class="results-list" id="resultsList">
                                <div class="results-empty">No results yet</div>
                            </div>
                        </div>

                        <div class="panel-section">
                            <h2>üíæ Export</h2>
                            <div class="export-buttons">
                                <button class="btn btn-secondary btn-full" id="exportBtn" disabled>
                                    Export Labels
                                </button>
                                <button class="btn btn-secondary btn-full" id="exportCurrentBtn" disabled style="display: none;" title="ÌòÑÏû¨ Î≥¥Í≥† ÏûàÎäî Ïù¥ÎØ∏ÏßÄÎßå ÎÇ¥Î≥¥ÎÇ¥Í∏∞">
                                    Export Current
                                </button>
                            </div>
                        </div>

                        <div class="panel-section">
                            <h2>üìù Review Queue</h2>
                            <div class="queue-list" id="queueList">
                                <div class="queue-empty">No pending reviews</div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>

        </main>

        <!-- Toast Notification -->
        <div class="toast" id="toast"></div>
    </div>

    <script src="/static/app.js?v=2"></script>
</body>
</html>
